## Part 1 Инструмент ipcalc
### 1.1
- 1\) 
- адрес сети 192.167.38.54/13 - 192.160.0.0

![Part1.1](Part1.1.png)

- 2\) 
- `перевод маски 255.255.255.0 в префиксную и двоичную запись:`
- 255.255.255.0 - 24 единички, следовательно префиксная запись: /24. Двоичная: 11111111.11111111.11111111.00000000
- `/15 в обычную и двоичную:`
- 15 единичек, в двоичной: 11111111.11111110.00000000.00000000, в обычной: 255.254.0.0
- `11111111.11111111.11111111.11110000 в обычную и префиксную`
- 28 единичек - /28. В обычной: 255.255.255.240
- 3\) `минимальный и максимальный хост в сети 12.167.38.4 при масках:`
- `/8` : min: 12.0.0.1, max: 12.255.255.254

![Part1.2](Part1.2.png)

- `11111111.11111111.00000000.00000000` : min: 12.167.0.1, max: 12.167.255.254

![Part1.3](Part1.3.png)

- `255.255.254.0`: min : 12.167.38.1, max: 12.167.39.254

![Part1.4](Part1.4.png)

- `/4`: min : 0.0.0.1 max: 15.255.255.254

![Part1.5](Part1.5.png)

### 1.2
- `Определить и записать в отчёт, можно ли обратиться к приложению, работающему на localhost, со следующими IP: 194.34.23.100, 127.0.0.2, 127.1.0.1, 128.0.0.1`
- диапазон локалхоста: 127.0.0.1 - 127.255.255.254
- 194.34.23.100: нельзя
- 127.0.0.2: можно
- 127.1.0.1: можно
- 128.0.0.1: нельзя
### 1.3
- 1\) `какие из перечисленных IP можно использовать в качестве публичного, а какие только в качестве частных: 10.0.0.45, 134.43.0.2, 192.168.4.2, 172.20.250.4, 172.0.2.1, 192.172.0.1, 172.68.0.2, 172.16.255.255, 10.10.10.10, 172.68.0.2, 192.169.168.1`
- публичные: 134.43.0.2, 172.0.2.1, 192.172.0.1, 172.68.0.2, 192.169.168.1
- частные: 10.0.0.45, 192.168.4.2, 172.20.250.4, 172.16.255.255, 10.10.10.10
- 2\) `какие из перечисленных IP адресов шлюза возможны у сети 10.10.0.0/18: 10.0.0.1, 10.10.0.2, 10.10.10.10, 10.10.100.1, 10.10.1.255`
- возможны: 10.10.0.2, 10.10.10.10, 10.10.1.255
- не возможны: 10.0.0.1, 10.10.100.1

## Part 2 Статическая маршрутизация между двумя машинами
- `ip a` на двух машинах
- ws1:

![Part 2](Part2.png)

- ws2:

![Part 2.0](Part2.0.png)

- `Описать сетевой интерфейс, соответствующий внутренней сети`
    - Сетевой интерфейс для внутренней сети - enp0s8.
- `etc/netplan/00-installer-config.yaml ws1:`

![Part 2.1](Part2.1.png)

- `etc/netplan/00-installer-config.yaml ws2:`

![Part 2.2](Part2.2.png)

- `sudo netplan apply ws1:`

![Part 2.3](Part2.3.png)

- `sudo netplan apply ws2:`

![Part 2.4](Part2.4.png)

### 2.1. Добавление статического маршрута вручную
- `Добавить статический маршрут от одной машины до другой и обратно при помощи команды вида ip r add`
- ws1:

![Part 2.5](Part2.5.png)

- ws2:

![Part 2.6](Part2.6.png)

- `Пропинговать соединение между машинами`:
- ws1:

![Part 2.7](Part2.7.png)

- ws2:

![Part 2.8](Part2.8.png)

### 2.2. Добавление статического маршрута с сохранением

- `Добавить статический маршрут от одной машины до другой с помощью файла etc/netplan/00-installer-config.yaml`

- ws1:

![Part 2.9](Part2.9.png)

- ws2:

![Part 2.10](Part2.10.png)

- `Пропинговать соединение между машинами`

- ws1:

![Part 2.11](Part2.11.png)

- ws2:

![Part 2.12](Part2.12.png)

## Part 3 Утилита iperf3

### 3.1. Скорость соединения

- `Перевести и записать в отчёт: 8 Mbps в MB/s, 100 MB/s в Kbps, 1 Gbps в Mbps`

- 8 Mbps = 1 MB/s
- 100 MB/s = 800000 Kbps
- 1 Gbps = 1000 Mbps

### 3.2. Утилита iperf3

- `Измерить скорость соединения между ws1 и ws2`

- ws1:

![Part3](Part3.png)

![Part3.1](Part3.1.png)

- ws2:

![Part3.2](Part3.2.png)

![Part3.3](Part3.3.png)

## Part 4 Сетевой экран

### 4.1. Утилита iptables

- /etc/firewall ws1

![Part4](Part4.png)

- /etc/firewall ws2

![Part4.1](Part4.1.png)

- `Запуск обоих файлов`

- ws1:

![Part4.2](Part4.2.png)

- ws2:

![Part4.3](Part4.3.png)

- Разница в стратегиях заключается в том, что изначально в машине ws1 мы сначала запрещаем, поэтому правило разрешения снизу не обрабатывается. В машине ws2 всё ровным счетом наоборот.

### 4.2. Утилита nmap

- `Командой ping найти машину, которая не "пингуется", после чего утилитой nmap показать, что хост машины запущен`

- проверяем пингом:

- ws1 не пингуется:

![Part4.3.0](Part4.3.0.png)

- ws2 пингуется:

![Part4.3.1](Part4.3.1.png)

- nmap

![Part4.4](Part4.4.png)

## Part 5. Статическая маршрутизация сети

### 5.1. Настройка адресов машин

- `Настроить конфигурации машин в etc/netplan/00-installer-config.yaml согласно сети на рисунке`

- r1:

![Part5](Part5.png)

- r2:

![Part5.1](Part5.1.png)

- ws11:

![Part5.2](Part5.2.png)

- ws21:

![Part5.3](Part5.3.png)

- ws22:

![Part5.4](Part5.4.png)

- `Перезапустить сервис сети. Если ошибок нет, то командой ip -4 a проверить, что адрес машины задан верно. Также пропинговать ws22 с ws21. Аналогично пропинговать r1 с ws11.`

- r1:

![Part5.5](Part5.5.png)

- r2:

![Part5.6](Part5.6.png)

- ws11:

![Part5.7](Part5.7.png)

- ws22:

![Part5.8](Part5.8.png)

- ws21:

![Part5.9](Part5.9.png)

### 5.2. Включение переадресации IP-адресов.

- `Для включения переадресации IP, выполните команду на роутерах: sysctl -w net.ipv4.ip_forward=1`

- r1: 

![Part5.10](Part5.10.png)

- r2: 

![Part5.11](Part5.11.png)

- `Откройте файл /etc/sysctl.conf и добавьте в него следующую строку:net.ipv4.ip_forward = 1`

- r1: 

![Part5.12](Part5.12.png)

- r2:

![Part5.13](Part5.13.png)

### 5.3. Установка маршрута по-умолчанию

- `Настроить маршрут по-умолчанию (шлюз) для рабочих станций. Для этого добавить default перед IP роутера в файле конфигураций`

- r1:

![Part5.14](Part5.14.png)

- r2:

![Part5.15](Part5.15.png)

- ws11:

![Part5.16](Part5.16.png)

- ws21:

![Part5.17](Part5.17.png)

- ws22:

![Part5.18](Part5.18.png)

- `Вызвать ip r и показать, что добавился маршрут в таблицу маршрутизации`

- r1: 

![Part5.19](Part5.19.png)

- r2:

![Part5.20](Part5.20.png)

- ws11:

![Part5.21](Part5.21.png)

- ws21:

![Part5.22](Part5.22.png)

- ws22:

![Part5.23](Part5.23.png)

- `Пропинговать с ws11 роутер r2 и показать на r2, что пинг доходит`

- ping:

![Part5.24](Part5.24.png)

- tcpdump:

![Part5.25](Part5.25.png)

### 5.4. Добавление статических маршрутов

- `Добавить в роутеры r1 и r2 статические маршруты в файле конфигураций`

- r1:

![Part5.26](Part5.26.png)

- r2:

![Part5.27](Part5.27.png)

- `Вызвать ip r и показать таблицы с маршрутами на обоих роутерах.`

- r1:

![Part5.28](Part5.28.png)

- r2:

![Part5.29](Part5.29.png)

- `Запустить команды на ws11:`

![Part5.30](Part5.30.png)

- Для адреса 10.10.0.0/18 был выбран маршрут, отличный от 0.0.0.0/0, поскольку он является адресом сети и доступен без шлюза.

## 5.5. Построение списка маршрутизаторов

- `Запустить на r1 команду дампа:`

![Part5.31](Part5.31.png)

![Part5.32](Part5.32.png)

- `При помощи утилиты traceroute построить список маршрутизаторов на пути от ws11 до ws21`

![Part5.33](Part5.33.png)

- Анализ вывода tcpdump позволяет проследить процесс построения пути с помощью утилиты traceroute в Linux. Traceroute использует увеличивающееся значение Time-To-Live (TTL) в заголовке IP-пакета, отправляемого к целевому узлу. При каждом шаге TTL увеличивается, что заставляет маршрутизаторы на пути отправить обратно ICMP Time Exceeded сообщение, указывая на истекший TTL. Анализ icmp-пакетов с помощью tcpdump позволяет видеть IP-адреса маршрутизаторов, через которые проходит пакет, и время, затраченное на прохождение до каждого из них. Это позволяет определить последовательность промежуточных узлов и оценить задержки на участках маршрута до целевого узла.

### 5.6. Использование протокола ICMP при маршрутизации

- `Запустить на r1 перехват сетевого трафика`

![Part5.34](Part5.34.png)

- `Пропинговать с ws11 несуществующий IP (например, 10.30.0.111)`

![Part5.35](Part5.35.png)

## Part 6. Динамическая настройка IP с помощью DHCP

- `Для r2 настроить в файле /etc/dhcp/dhcpd.conf конфигурацию службы DHCP:`

- `1) указать адрес маршрутизатора по-умолчанию, DNS-сервер и адрес внутренней сети.`

![Part6](Part6.png)

- `2) в файле resolv.conf прописать nameserver 8.8.8.8.`

![Part6.1](Part6.1.png)

- `Перезагрузить службу DHCP командой systemctl restart isc-dhcp-serve`

![Part6.2](Part6.2.png)

- `Машину ws21 перезагрузить при помощи reboot и через ip a показать, что она получила адрес. Также пропинговать ws22 с ws21.`

![Part6.3](Part6.3.png)

- ws22 to ws21 ping:

![Part6.4](Part6.4.png)

- `Указать MAC адрес у ws11, для этого в etc/netplan/00-installer-config.yaml надо добавить строки: macaddress: 10:10:10:10:10:BA, dhcp4: true`

![Part6.5](Part6.5.png)

- `Для r1 настроить аналогично r2, но сделать выдачу адресов с жесткой привязкой к MAC-адресу (ws11). Провести аналогичные тесты`

- dhcpd.conf:

![Part6.6](Part6.6.png)

- resolv.conf:

![Part6.7](Part6.7.png)

- restart:

![Part6.8](Part6.8.png)

- ip a:

![Part6.9](Part6.9.png)

- `Запросить с ws21 обновление ip адреса`

- до:

![Part6.10](Part6.10.png)

- после:

![Part6.11](Part6.11.png)

- использованные команды
- `sudo dhclient -r enp0s3`
- `sudo dhclient enp0s3`

## Part 7. NAT

- `В файле /etc/apache2/ports.conf на ws22 и r2 изменить строку Listen 80 на Listen 0.0.0.0:80, то есть сделать сервер Apache2 общедоступным.`

- r1:

![Part7.0](Part7.0.png)

- ws22:

![Part7.1](Part7.1.png)

- `Запустить веб-сервер Apache командой service apache2 start на ws22 и r1`

- r1:

![Part7.2](Part7.2.png)

- ws22:

![Part7.3](Part7.3.png)

- `Добавить в фаервол, созданный по аналогии с фаерволом из Части 4, на r2 следующие правила:`

- 1) удаление правил в таблице filter - iptables -F
- 2) удаление правил в таблице "NAT" - iptables -F -t nat
- 3) отбрасывать все маршрутизируемые пакеты - iptables --policy FORWARD DROP

![Part7.4](Part7.4.png)

- `Проверить соединение между ws22 и r1 командой ping
- При запуске файла с этими правилами, ws22 не должна "пинговаться" с r1

- r1 to ws22:

![Part7.5](Part7.5.png)

- ws22 to r1:

![Part7.6](Part7.6.png)

- `Добавить в файл ещё одно правило:`

- 4) разрешить маршрутизацию всех пакетов протокола ICMP

![Part7.7](Part7.7.png)

- `Проверить соединение между ws22 и r1 командой ping`

- При запуске файла с этими правилами, ws22 должна "пинговаться" с r1

- r1 to ws22:

![Part7.8](Part7.8.png)

- ws22 to r1:

![Part7.9](Part7.9.png)

- `Добавить в файл ещё два правила:`

5) включить SNAT, а именно маскирование всех локальных ip из локальной сети, находящейся за r2 (по обозначениям из Части 5 - сеть 10.20.0.0)
Совет: стоит подумать о маршрутизации внутренних пакетов, а также внешних пакетов с установленным соединением

6) включить DNAT на 8080 порт машины r2 и добавить к веб-серверу Apache, запущенному на ws22, доступ извне сети

![Part7.10](Part7.10.png)

- `Проверить соединение по TCP для SNAT, для этого с ws22 подключиться к серверу Apache на r1`:

![Part7.11](Part7.11.png)

- `Проверить соединение по TCP для DNAT, для этого с r1 подключиться к серверу Apache на ws22`:

![Part7.12](Part7.12.png)

## Part 8. Дополнительно. Знакомство с SSH Tunnels

- `Запустить веб-сервер Apache на ws22 только на localhost (то есть в файле /etc/apache2/ports.conf изменить строку Listen 80 на Listen localhost:80)`

![Part8.0](Part8.0.png)

- запуск:

![Part8.1](Part8.1.png)

- `воспользоваться Local TCP forwarding с ws21 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws21`

![Part8.local](Part8.local.png)

- `Воспользоваться Remote TCP forwarding c ws11 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws11`

![Part8.remote1](Part8.remote1.png)
![Part8.remote2](Part8.remote2.png)

- `Для проверки, сработало ли подключение в обоих предыдущих пунктах, перейдите во второй терминал (например, клавишами Alt + F2) и выполните команду:
telnet 127.0.0.1 [локальный порт]`

- ws21:

![Part8.0.7](Part8.0.7.png)


- ws11:

![Part8.4](Part8.4.png)